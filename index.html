<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Timeline Manager - Miro App</title>
    <script src="https://miro.com/app/static/sdk/v2/miro.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        function ProjectTimeline() {
          const [projects, setProjects] = useState([
            {
              id: 1,
              name: 'Product Brief',
              phase: 'Discover',
              startDate: '2025-03-30',
              endDate: '2025-04-17',
              status: 'In Progress',
              health: 'R',
              progress: 45
            },
            {
              id: 2,
              name: 'Research',
              phase: 'Discover',
              startDate: '2025-04-07',
              endDate: '2025-04-23',
              status: 'Planning',
              health: 'Y',
              progress: 20
            },
            {
              id: 3,
              name: 'User Journey Diagrams',
              phase: 'Define',
              startDate: '2025-04-11',
              endDate: '2025-04-29',
              status: 'In Progress',
              health: 'G',
              progress: 60
            }
          ]);

          const [showAddForm, setShowAddForm] = useState(false);
          const [newProject, setNewProject] = useState({
            name: '',
            phase: 'Discover',
            startDate: '',
            endDate: '',
            status: 'Not Started',
            health: 'G',
            progress: 0
          });

          const phases = ['Discover', 'Define', 'Deliver'];
          const phaseColors = {
            Discover: { bg: '#FFF9C4', border: '#F57F17' },
            Define: { bg: '#C8E6C9', border: '#2E7D32' },
            Deliver: { bg: '#BBDEFB', border: '#1565C0' }
          };
          const healthColors = {
            G: { bg: '#C8E6C9', text: '#2E7D32' },
            Y: { bg: '#FFF9C4', text: '#F57F17' },
            R: { bg: '#FFCDD2', text: '#C62828' }
          };

          const calculateTimelinePosition = (startDate, endDate) => {
            const allDates = projects.flatMap(p => [new Date(p.startDate), new Date(p.endDate)]);
            const minDate = new Date(Math.min(...allDates));
            const maxDate = new Date(Math.max(...allDates));
            const totalDays = (maxDate - minDate) / (1000 * 60 * 60 * 24);
            const start = new Date(startDate);
            const end = new Date(endDate);
            const startOffset = (start - minDate) / (1000 * 60 * 60 * 24);
            const duration = (end - start) / (1000 * 60 * 60 * 24);
            return {
              left: `${(startOffset / totalDays) * 100}%`,
              width: `${(duration / totalDays) * 100}%`
            };
          };

          const addProject = () => {
            if (newProject.name && newProject.startDate && newProject.endDate) {
              setProjects([...projects, { ...newProject, id: Date.now() }]);
              setNewProject({
                name: '',
                phase: 'Discover',
                startDate: '',
                endDate: '',
                status: 'Not Started',
                health: 'G',
                progress: 0
              });
              setShowAddForm(false);
            }
          };

          const deleteProject = (id) => {
            setProjects(projects.filter(p => p.id !== id));
          };

          const updateProject = (id, field, value) => {
            setProjects(projects.map(p => p.id === id ? { ...p, [field]: value } : p));
          };

          const createMiroCards = async () => {
            try {
              const cardWidth = 400;
              const cardHeight = 200;
              const gap = 50;
              let yPos = 0;

              for (const project of projects) {
                const phaseColor = phaseColors[project.phase];
                
                await miro.board.createShape({
                  shape: 'rectangle',
                  x: 0,
                  y: yPos,
                  width: cardWidth,
                  height: cardHeight,
                  style: {
                    fillColor: '#ffffff',
                    borderColor: phaseColor.border,
                    borderWidth: 4,
                    fontSize: 14
                  },
                  content: `<strong>${project.phase.toUpperCase()}: ${project.name}</strong><br><br>` +
                           `üìÖ ${new Date(project.startDate).toLocaleDateString()} ‚Üí ${new Date(project.endDate).toLocaleDateString()}<br>` +
                           `üìä Status: ${project.status}<br>` +
                           `‚ù§Ô∏è Health: ${project.health}<br>` +
                           `üìà Progress: ${project.progress}%`
                });

                yPos += cardHeight + gap;
              }

              alert('‚úÖ Timeline criada no Miro Board!');
            } catch (error) {
              console.error('Error creating cards:', error);
              alert('Erro ao criar cards no Miro');
            }
          };

          const groupedProjects = phases.reduce((acc, phase) => {
            acc[phase] = projects.filter(p => p.phase === phase);
            return acc;
          }, {});

          return (
            <div className="min-h-screen bg-gray-50 p-6" style={{maxHeight: '100vh', overflowY: 'auto'}}>
              <div className="max-w-4xl mx-auto">
                <div className="bg-white rounded-lg shadow-sm p-4 mb-4">
                  <div className="flex items-center justify-between">
                    <div>
                      <h1 className="text-xl font-bold text-gray-900">Project Timeline Manager</h1>
                      <p className="text-xs text-gray-500">Manage your design sprint projects</p>
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={() => setShowAddForm(!showAddForm)}
                        className="px-3 py-2 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600"
                      >
                        ‚ûï Add
                      </button>
                      <button
                        onClick={createMiroCards}
                        className="px-3 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm rounded-lg hover:shadow-lg"
                      >
                        üöÄ Create on Board
                      </button>
                    </div>
                  </div>
                </div>

                {showAddForm && (
                  <div className="bg-white rounded-lg shadow-sm p-4 mb-4">
                    <h3 className="text-sm font-semibold mb-3">New Project</h3>
                    <div className="grid grid-cols-2 gap-3 mb-3">
                      <div>
                        <label className="block text-xs font-medium text-gray-700 mb-1">Name</label>
                        <input
                          type="text"
                          value={newProject.name}
                          onChange={(e) => setNewProject({ ...newProject, name: e.target.value })}
                          className="w-full px-2 py-1 text-sm border border-gray-300 rounded"
                          placeholder="Project name"
                        />
                      </div>
                      <div>
                        <label className="block text-xs font-medium text-gray-700 mb-1">Phase</label>
                        <select
                          value={newProject.phase}
                          onChange={(e) => setNewProject({ ...newProject, phase: e.target.value })}
                          className="w-full px-2 py-1 text-sm border border-gray-300 rounded"
                        >
                          {phases.map(phase => (
                            <option key={phase} value={phase}>{phase}</option>
                          ))}
                        </select>
                      </div>
                      <div>
                        <label className="block text-xs font-medium text-gray-700 mb-1">Start Date</label>
                        <input
                          type="date"
                          value={newProject.startDate}
                          onChange={(e) => setNewProject({ ...newProject, startDate: e.target.value })}
                          className="w-full px-2 py-1 text-sm border border-gray-300 rounded"
                        />
                      </div>
                      <div>
                        <label className="block text-xs font-medium text-gray-700 mb-1">End Date</label>
                        <input
                          type="date"
                          value={newProject.endDate}
                          onChange={(e) => setNewProject({ ...newProject, endDate: e.target.value })}
                          className="w-full px-2 py-1 text-sm border border-gray-300 rounded"
                        />
                      </div>
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={addProject}
                        className="px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600"
                      >
                        ‚úì Add
                      </button>
                      <button
                        onClick={() => setShowAddForm(false)}
                        className="px-3 py-1 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300"
                      >
                        ‚úï Cancel
                      </button>
                    </div>
                  </div>
                )}

                {phases.map(phase => (
                  groupedProjects[phase].length > 0 && (
                    <div key={phase} className="mb-4">
                      <div className="bg-white rounded-lg shadow-sm overflow-hidden">
                        <div 
                          className="px-4 py-2 flex items-center gap-2"
                          style={{ 
                            backgroundColor: phaseColors[phase].bg,
                            borderLeft: `4px solid ${phaseColors[phase].border}`
                          }}
                        >
                          <span 
                            className="px-2 py-1 rounded-full text-xs font-bold text-white"
                            style={{ backgroundColor: phaseColors[phase].border }}
                          >
                            {phase}
                          </span>
                          <span className="text-xs text-gray-600">
                            {groupedProjects[phase].length} projects
                          </span>
                        </div>

                        <div className="p-4 space-y-3">
                          {groupedProjects[phase].map(project => {
                            const timeline = calculateTimelinePosition(project.startDate, project.endDate);
                            
                            return (
                              <div key={project.id} className="border border-gray-200 rounded-lg p-3">
                                <div className="flex items-center justify-between mb-2">
                                  <div className="flex items-center gap-2 flex-1">
                                    <h4 className="font-semibold text-sm text-gray-900">{project.name}</h4>
                                    <span className="px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded-full">
                                      {project.status}
                                    </span>
                                    <div 
                                      className="w-5 h-5 rounded flex items-center justify-center text-xs font-bold"
                                      style={{
                                        backgroundColor: healthColors[project.health].bg,
                                        color: healthColors[project.health].text
                                      }}
                                    >
                                      {project.health}
                                    </div>
                                  </div>
                                  <button
                                    onClick={() => deleteProject(project.id)}
                                    className="p-1 text-red-500 hover:bg-red-50 rounded text-xs"
                                  >
                                    üóëÔ∏è
                                  </button>
                                </div>

                                <div className="grid grid-cols-3 gap-2 mb-2 text-xs">
                                  <div>
                                    <span className="text-gray-500">Start:</span>
                                    <span className="ml-1 font-medium">{new Date(project.startDate).toLocaleDateString()}</span>
                                  </div>
                                  <div>
                                    <span className="text-gray-500">End:</span>
                                    <span className="ml-1 font-medium">{new Date(project.endDate).toLocaleDateString()}</span>
                                  </div>
                                  <div>
                                    <span className="text-gray-500">Progress:</span>
                                    <span className="ml-1 font-medium">{project.progress}%</span>
                                  </div>
                                </div>

                                <div className="relative h-6 bg-gray-100 rounded-full overflow-hidden">
                                  <div
                                    className="absolute top-0 h-full rounded-full transition-all"
                                    style={{
                                      ...timeline,
                                      backgroundColor: phaseColors[phase].border,
                                      opacity: 0.3
                                    }}
                                  />
                                  <div
                                    className="absolute top-0 h-full rounded-full transition-all"
                                    style={{
                                      left: timeline.left,
                                      width: `calc(${timeline.width} * ${project.progress / 100})`,
                                      backgroundColor: phaseColors[phase].border
                                    }}
                                  />
                                </div>

                                <div className="mt-2">
                                  <input
                                    type="range"
                                    min="0"
                                    max="100"
                                    value={project.progress}
                                    onChange={(e) => updateProject(project.id, 'progress', parseInt(e.target.value))}
                                    className="w-full h-1"
                                  />
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    </div>
                  )
                ))}
              </div>
            </div>
          );
        }

        ReactDOM.render(<ProjectTimeline />, document.getElementById('root'));
    </script>
</body>
</html>
